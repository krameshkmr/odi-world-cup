---
title: "A Predictive Model for ODI World Cup Matches"
author: "Krishna Kumar, Srihari Srinivasan"
date: "APR 30, 2023"
output:
  pdf_document: default
---

```{r setup, include=FALSE}
library(tidyverse)
library(knitr)
library(tinytex)
library(cricketdata)
library(leaps)

knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(out.width = "60%")
#knitr::opts_chunk$set(fig.align = "center")
```

## Introduction

Given that this is a One Day International (ODI) World Cup year, our analysis of batting and bowling performance metrics on the margin of victory, `mov`, is focused on prior World Cup matches. With knowledge of how the ODI format has changed since the introduction of the shorter, Twenty20 (T20) format, particularly the 2007 T20 World Cup, we have limited our data to the last five ODI World Cups (2003, 2007, 2011, 2015, and 2019). After wrangling six batting metrics and four bowling metrics from 4774 individual player performances, we are looking to build a predictive model and gain insight as to which metrics, if any, have an effect on `mov`. In doing so, while this may be beyond the scope of this project, we hope to ultimately use our model to predict the outcome of the 2023 ODI World Cup.

## Exploratory Analysis

```{r, echo=FALSE}
odi <- read.csv("~/Downloads/odi.csv")
odi$date <- as.Date(odi$date)
odi$date <- format(odi$date, "%Y")
odi <- rename(odi, year = date)
```

### Response Variable

`mov` is the difference between the target set by the team batting first and the total that the chasing team achieved. For example, in a 2003 match between England and Pakistan, England scored 246 runs, setting 247 as the target for Pakistan to chase. They, however, were bowled out for 134, resulting in England winning by 112 runs. Therefore, the `mov` for this match is calculated as $winner\_margin / target = 112 / 247 = 0.453$.\

The figure below is a boxplot of `mov` values.\

```{r, echo=FALSE}
odi %>% ggplot(aes(x = mov)) + 
        geom_boxplot(fill = "skyblue", color = "black") + 
        labs(x = "Margin of Victory") +
        theme_bw()

summary(odi$mov)
```

From the figure and summary, we can see that `mov` is approximately normally distributed on 7.1%. The single outlier is a 2011 match between Kenya and New Zealand in which Kenya lost by 84.0%. While large `mov` values can be attributed to a blowout, the extreme values probably occurred due to a wide skill gap between two teams. New Zealand, for example, is an established cricketing nation with a strong, experienced team compared to Kenya.

### Predictor Variables

Batting metrics:\
1. `to_runs_pct` - percentage of total runs scored by the top order\
2. `mo_runs_pct` - percentage of total runs scored by the middle order\
3. `to_mins_pct` - percentage of total time spent in crease by the top order\
4. `mo_mins_pct` - percentage of total time spent in crease by the middle order\
5. `to_bf_pct` - percentage of total balls faced by the top order\
6. `mo_bf_pct` - percentage of total balls faced by the middle order\
7. `pct_4s` - percentage of total runs that are 4s\
8. `pct_6s` - percentage of total runs that are 6s\
9. `to_sr` - average strike rate of the top order\
10. `mo_sr` - average strike rate of the middle order\

```{r}
odi %>% 
  select(to_runs_pct, mo_runs_pct,, to_mins_pct, mo_mins_pct, to_bf_pct, mo_bf_pct, pct_4s, pct_6s, to_sr, mo_sr, mov) %>% 
  pairs()
```

```{r}
round(cor(odi[, 6:20]), 2)
```



## Model Development

For our model development, we decided to use a backward step-wise selection approach. Because we use a multiple regression model to predict `mov`, we decided to compare *RMSE*(Root Mean Squared Errror) for determining the "best" collection of predictor variables to include in the model. *RMSE* is the average difference between values predicted by a model and the actual values. This will tell us generally how far apart our predicted values are from the actual values. First, we split our `odi` dataset into a *training set* and *test set*. The training set includes data from 2003 to 2005 ODI World Cups and the test set includes data from the 2019 ODI World Cup. 

```{r, echo = FALSE}
train_set <- odi %>% filter(year %in% c(2003, 2007, 2011, 2015))
train_set <- train_set[, 6:20]

test_set <- odi %>% filter(year == 2019)
test_set <- test_set[, 6:20]

model_1 <- lm(mov~., data=train_set)
summary(model_1)

predictions <- predict(model_1, test_set)
rmse <- sqrt(mean((test_set$mov - predictions)^2))
rmse
rmse / (max(test_set$mov) - min(test_set$mov))
```

After training our multiple regression model using all 14 predictor variables, we can see the *Adjusted R-Squared* value is 0.881 meaning we are able to explain 88.1% of the variation in `mov` using our 14 predictor variables. Using this model, we predicted `mov` based on the test set and calculated the *RMSE*, getting a value of around 0.153. If we normalize the *RMSE* by dividing the RMSE by the range of the test set's `mov`, we get a value of around 0.133. 


## Model Analysis

## Conclusion
